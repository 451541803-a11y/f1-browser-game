<script>
        const SPEED_LIMIT = 30;
        const ACCELERATION_FORCE = 500; // Increased force for visible movement
        const TURN_SPEED = 2.5; 
        const DRAG_FACTOR = 0.98; 

        // Object to track which keys are currently pressed
        const inputMap = {};
        
        let playerCar; // Global reference for the car body

        // --- 1. Scene Creation Function ---
        const createScene = function (canvas, engine) {
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3(0.1, 0.1, 0.2); 
            
            // Lighting
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
            light.intensity = 0.7;

            // Camera Setup
            const camera = new BABYLON.FollowCamera("FollowCam", new BABYLON.Vector3(0, 10, -10), scene);
            camera.radius = 12; 
            camera.heightOffset = 4; 
            camera.rotationOffset = 180;
            camera.cameraAcceleration = 0.05;
            camera.maxCameraSpeed = 50;
            
            // Crucially, detach default camera controls so other inputs work
            camera.inputs.clear(); 
            camera.attachControl(canvas, true);

            // Physics Engine Activation
            const gravityVector = new BABYLON.Vector3(0, -9.81, 0);
            const physicsEngine = new BABYLON.CannonJSPlugin(); 
            scene.enablePhysics(gravityVector, physicsEngine);

            // Ground/Track
            const ground = BABYLON.MeshBuilder.CreateGround("ground", {width: 100, height: 100}, scene);
            ground.material = new BABYLON.StandardMaterial("groundMat", scene);
            ground.material.diffuseColor = new BABYLON.Color3(0.1, 0.5, 0.1); 
            ground.physicsImpostor = new BABYLON.PhysicsImpostor(
                ground, 
                BABYLON.PhysicsImpostor.BoxImpostor, 
                { mass: 0, restitution: 0.1 }, 
                scene
            );
            
            // Player Car (Box Model)
            playerCar = BABYLON.MeshBuilder.CreateBox("playerCar", {width: 2, height: 1, depth: 4}, scene);
            playerCar.position.y = 1; 
            playerCar.material = new BABYLON.StandardMaterial("carMat", scene);
            playerCar.material.diffuseColor = new BABYLON.Color3(1, 0, 0); // Red Car
            playerCar.physicsImpostor = new BABYLON.PhysicsImpostor(
                playerCar, 
                BABYLON.PhysicsImpostor.BoxImpostor, 
                { mass: 10, friction: 0.5, restitution: 0.1 },
                scene
            );
            
            // Set the camera target to the car
            camera.lockedTarget = playerCar;

            // --- 2. Input Handling (Replaced ActionManager) ---
            window.addEventListener('keydown', (evt) => {
                inputMap[evt.key.toLowerCase()] = true; // Use toLowerCase for simplicity
                // Prevent default browser behavior (like scrolling or back button)
                if (['w', 'a', 's', 'd'].includes(evt.key.toLowerCase())) {
                    evt.preventDefault();
                }
            });
            
            window.addEventListener('keyup', (evt) => {
                inputMap[evt.key.toLowerCase()] = false;
            });


            // --- 3. Game Loop (Called every frame before render) ---
            scene.onBeforeRenderObservable.add(() => {
                const physicsImpostor = playerCar.physicsImpostor;
                if (!physicsImpostor) return;

                let velocity = physicsImpostor.getLinearVelocity();
                let currentSpeed = velocity.length();

                // Get direction vectors
                const forward = playerCar.forward;
                
                let force = BABYLON.Vector3.Zero();

                // --- ACCELERATION (W) ---
                if (inputMap["w"]) {
                    if (currentSpeed < SPEED_LIMIT) {
                         force = force.add(forward.scale(ACCELERATION_FORCE));
                    }
                }
                
                // --- BRAKING/REVERSE (S) ---
                if (inputMap["s"]) {
                    // Apply reverse force or strong brake force
                    force = force.add(forward.scale(-ACCELERATION_FORCE * 0.75));
                }

                // --- TURNING (A/D) ---
                let torqueFactor = 0;
                if (currentSpeed > 0.5) {
                    if (inputMap["a"]) {
                        torqueFactor += -TURN_SPEED; // Turn left
                    }
                    if (inputMap["d"]) {
                        torqueFactor += TURN_SPEED; // Turn right
                    }
                }
                
                // Apply rotation (torque) to the Y-axis
                if (torqueFactor !== 0) {
                    physicsImpostor.setAngularVelocity(new BABYLON.Vector3(0, torqueFactor, 0));
                } else {
                    // Reduce angular velocity when not turning
                    let angularVelocity = physicsImpostor.getAngularVelocity();
                    physicsImpostor.setAngularVelocity(angularVelocity.scale(DRAG_FACTOR));
                }

                // Apply the calculated force explicitly at the center of mass (the car's position)
                physicsImpostor.applyForce(force, playerCar.getAbsolutePosition());
                
                // Update HUD
                const speedKPH = (currentSpeed * 3.6).toFixed(1);
                document.getElementById('status').innerText = `Speed: ${speedKPH} km/h`;
            });


            return scene;
        }

        // --- Main Engine Initialization ---
        window.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('renderCanvas');
            const status = document.getElementById('status');
            
            if (!canvas) {
                console.error("CRITICAL ERROR: Canvas element was not found.");
                if (status) status.innerText = "Error: Canvas not found.";
                return;
            }
            
            const engine = new BABYLON.Engine(canvas, true);
            const scene = createScene(canvas, engine);

            engine.runRenderLoop(function () {
                if (scene) {
                    scene.render();
                }
            });

            window.addEventListener('resize', function () {
                engine.resize();
            });
            
            if (status) status.innerText = "Ready!";
        });
    </script>
    ```

### 2. Final Test

1.  **Commit** the completely rewritten `index.html`.
2.  **Hard Refresh** your game URL (`Ctrl+Shift+R`).
3.  **Test:** Click the screen to ensure focus, then press **W, A, S, and D**.

This robust input method should now capture the keys, and the increased force should make the car move visibly.

Once the controls are confirmed working, we can immediately move on to **building a simple track** with walls!
